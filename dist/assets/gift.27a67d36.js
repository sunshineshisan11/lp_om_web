import{$ as y,_ as D,r as h,J as F,K as G,b as j,H as L,G as H,o as d,f,g as e,n as P,t as g,h as v,F as V,p as w,w as q,L as K,k as A,l as O,j as T,s as Q,z as R,x as W,y as X,A as Y,B as n,C as B,M as b,q as Z,i as U}from"./main.e5148843.js";var S={updateMoney:function(c){return y.get("api/get/updateMoney",c)},getGift:function(c){return y.get("api/get/gift",c)},giftVoteAdd:function(c){return y.get("api/update/giftVoteAdd",c)},setVote:function(c){return y.get("api/set/vote",c)},addVote:function(c){return y.get("api/add/vote",c)}};const ee={class:"main"},te={class:"bg"},oe={class:"content"},se={class:"title"},le={class:"gifts"},ae={class:"container"},ie=["onClick"],re=["src"],ne={class:"dec"},ce={class:"NO"},ue={class:"vote"},de={key:0,class:"shopCat",style:{"margin-top":"20vh"}},fe={class:"top magB10"},ge={key:0,class:"item"},ve={class:"bottom"},_e={class:"votePrice"},me={class:"submit"},pe={class:"dialogContent"},he={key:0,class:"giftItem"},ke={class:"left"},ye={class:"name"},be={class:"number"},Ce={class:"dialog-footer"},Ne={__name:"gift",setup(c){let o={en:Q,zh:R,jp:W,ko:X,vi:Y}[localStorage.getItem("language")];h(""),F(()=>{}),G(()=>{});let _=[],a=h([]),$=h([]),k=h(!1);const I=()=>{S.getGift().then(l=>{l.code==0?(_=l.rows,a.value=_,localStorage.setItem("gift",JSON.stringify(_)),console.log(a.value)):n.error(l.error)})};localStorage.getItem("gift")?(_=JSON.parse(localStorage.getItem("gift")),a.value=_):I();const z=l=>{a.value[l].flag?a.value[l].flag=!1:a.value[l].flag=!0;for(let t=0;t<a.value.length;t++)if(a.value[t].flag!=!1){k.value=!0;break}else k.value=!1},x=h(!1),r=h(),E=()=>{x.value=!1,$.value=[],r.value="";for(let l in _)_[l].flag=!1;a.value=JSON.parse(JSON.stringify(_)),k.value=!1,console.log(a.value)},M=()=>{B.get_user({account:JSON.parse(localStorage.getItem("user")).account}).then(l=>{if(l.code==0){const t=l.rows[0];console.log(t),delete t.password,u.user=t;const p=t;localStorage.setItem("user",JSON.stringify(p))}else n.error("fail")})},u=j();M();let C=0,N=[];const J=async()=>{let l=!1,t=0,p=[];for(let i=0;i<a.value.length;i++)a.value[i].flag&&(p.push(a.value[i]),t++);if(N=p,C=t,t>0&&(l=!0),!l){n.error(o.gift.message[0]);return}if(!r.value){n.error(o.gift.message[1]);return}if(r.value*C>u.user.money){n.error(o.gift.message[2]);return}if(k.value=!1,u.user.dataError==1){b.error({title:o.gift.model.title,content:o.gift.model.content[0],okText:o.gift.model.okText});return}if(u.user.dataError==2){b.error({title:o.gift.model.title,content:o.gift.model.content[1],okText:o.gift.model.okText});return}if(u.user.dataError==3){b.error({title:o.gift.model.title,content:o.gift.model.content[2],okText:o.gift.model.okText});return}if(u.user.dataError==4){b.error({title:o.gift.model.title,content:o.gift.model.content[3],okText:o.gift.model.okText});return}if(C==2&&(r.value==25e3||r.value==5e4)&&await B.dataError({account:u.user.account}).then(i=>{i.code==0?b.error({title:o.gift.model.title,content:o.gift.model.content[0],okText:o.gift.model.okText}):n.error("fail")}),u.user.voteFlag!=1){n.error("fail"),setInterval(()=>{},3600);return}for(let i=0;i<N.length;i++)await S.giftVoteAdd({id:N[i].id,vote:r.value}).then(s=>{console.log(s),s.code==0?I():n.error(s.error)}),await S.addVote({account:u.user.account,voteId:N[i].name,voteNum:r.value}).then(s=>{s.code==0||n.error(s.error)});if(C==1&&(r.value==3e4||r.value==5e4)){await S.updateMoney({type:0,makeMoney:r.value*.2,account:u.user.account,voteFlag:0}).then(i=>{i.code==0?(n.success("success"),E(),M()):n.error(i.error)});return}};return(l,t)=>{const p=L,i=H;return d(),f("div",ee,[e("div",te,[e("div",{class:"bgHead",style:P({"background-image":"url("+l.$domain+"/bg2.jpg)"})},t[2]||(t[2]=[e("div",{class:"bColor"},null,-1)]),4)]),e("div",oe,[e("div",se,g(v(o).gift.title),1),e("div",le,[e("div",ae,[(d(!0),f(V,null,w(v(a),(s,m)=>(d(),f("div",{class:Z(["gift",s.flag?"active":""]),key:m,onClick:xe=>z(m)},[e("img",{src:l.$domain+"/"+s.src,alt:""},null,8,re),e("div",ne,[e("small",ce,"NO."+g(s.name),1),t[3]||(t[3]=U()),e("small",ue,"vote:"+g(s.vote),1)])],10,ie))),128))])]),t[4]||(t[4]=e("div",{class:"cricle",style:{position:"absolute",top:"0"}},null,-1))]),v(k)?(d(),f("div",de,[e("div",fe,[(d(!0),f(V,null,w(v(a),(s,m)=>(d(),f("div",{class:"giftList",key:m},[s.flag?(d(),f("div",ge,"NO."+g(s.name)+g(m>=v(a).length?"":"\xA0"),1)):T("",!0)]))),128))]),e("div",ve,[e("div",_e,[q(e("input",{type:"number",maxlength:"9","onUpdate:modelValue":t[0]||(t[0]=s=>r.value=s)},null,512),[[K,r.value]])]),e("div",me,[A(p,{class:"submit",onClick:J},{default:O(()=>[U(g(v(o).gift.buttons[0]),1)]),_:1})])]),A(i,{modelValue:x.value,"onUpdate:modelValue":t[1]||(t[1]=s=>x.value=s),width:"500","show-close":!1},{footer:O(()=>[e("div",Ce,[e("div",{class:"button close",onClick:E},g(v(o).gift.dialog.buttons[0]),1),e("div",{class:"button",onClick:J},g(v(o).gift.dialog.buttons[1]),1)])]),default:O(()=>[e("div",pe,[(d(!0),f(V,null,w(v(a),(s,m)=>(d(),f("div",{class:"gifts",key:m},[s.flag?(d(),f("div",he,[e("div",ke,[e("div",ye,"NO."+g(s.name),1),e("div",be,"\u7968\u6578\uFF1A"+g(r.value)+"\u7968",1)])])):T("",!0)]))),128))])]),_:1},8,["modelValue"])])):T("",!0)])}}};var we=D(Ne,[["__scopeId","data-v-76240f92"]]);export{we as default};
//# sourceMappingURL=gift.27a67d36.js.map
